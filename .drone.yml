---
kind: pipeline
type: docker
name: firmware

steps:
- name: fetch-submodules
  image: alpine/git
  commands:
  - git submodule update --init --recursive

- name: build
  image: petewall/platformio
  commands:
  - cp hardware/firmware/include/credentials.example.h hardware/firmware/include/credentials.h
  - cd hardware/firmware && make

- name: test
  image: petewall/platformio
  commands:
  - cd hardware/firmware && PLATFORM=desktop make test


---
kind: pipeline
type: docker
name: backend

steps:
- name: build
  image: golang
  commands:
  - cd server && make

- name: test
  image: golang
  commands:
  - cd server && make test

---
kind: pipeline
type: docker
name: frontend

steps:
- name: build
  image: gableroux/flutter:v1.9.1_hotfix.4
  commands:
  - cd app && flutter build apk --release

- name: test
  image: gableroux/flutter:v1.9.1_hotfix.4
  commands:
  - cd app && flutter pub get && flutter test
