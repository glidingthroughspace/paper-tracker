@startuml
title ESP-Server communication

participant ESP
participant Server

loop
  ESP->ESP: Wakeup
  ESP->ESP: Connect to WiFi
  alt No tracker ID saved
  ESP->Server: Request tracker ID
  Server-->ESP: New tracker ID
  ESP->ESP: Save tracker ID
  end
  ESP->Server: Ask for new commands
  ESP<--Server: Command
  ESP->ESP: Execute command
  ESP->Server: Result
  ESP<--Server: Acknowledge + sleep time
  alt Sleep Time is greater than X seconds
  ESP->ESP: Deep sleep with given sleep time
  else
  ESP->ESP: Wait for given sleep time
  end
end

|||
|||
...Commands...

group Tracking command
  ESP->ESP: Collect number of available APs

  ESP->ESP: Gather information about AP into List
  loop For every AP batch of size X
  ESP->Server: Send batch information about APs
  end
  ESP<--Server: Acknowledge
end

group Signal location
  loop For X seconds
  ESP->ESP: Turn on LED and/or buzzer
  ESP->ESP: Wait X milliseconds
  ESP->ESP: Turn off LED and/or buzzer
  ESP->ESP: Wait X milliseconds
  end
end
@enduml